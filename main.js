(()=>{"use strict";var e,t={formSelector:".popup__form",formFieldsetSelector:".popup__form-set",inputSelector:".popup__input",inputErrorInvalid:"popup__input_invalid",submitButtonSelector:".popup__form-submit",inactiveButtonClass:"popup__form-submit_inactive",errorClass:"popup__input-error_active"},n={baseUrl:"https://mesto.nomoreparties.co/v1/plus-cohort-5",headers:{authorization:"20520870-6cab-4f4f-bbfa-ddd25c12eab2","Content-Type":"application/json"}},o=document.querySelectorAll(".popup"),r=document.querySelector(".popup_edit"),c=r.querySelector(".popup__form"),a=c.querySelector("#name"),i=c.querySelector("#job"),l=document.querySelector(".popup_add"),u=l.querySelector(".popup__form"),s=u.querySelector("#name-card"),d=u.querySelector("#link"),p=document.querySelector(".popup_update-avatar"),f=p.querySelector(".popup__form"),_=f.querySelector("#linkNewPhoto"),m=function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))},v=document.querySelector(".profile"),h=v.querySelector(".profile__image"),y=v.querySelector(".profile__image-overlay"),S=v.querySelector(".profile__title"),b=v.querySelector(".profile__subtitle"),q=v.querySelector(".profile__edit"),g=v.querySelector(".profile__add"),k=function(e,t,n){L(e)?(t.classList.add(n.inactiveButtonClass),t.setAttribute("disabled",!0)):(t.classList.remove(n.inactiveButtonClass),t.removeAttribute("disabled"))},L=function(e){return e.some((function(e){return!e.validity.valid}))};function E(e){"Escape"===e.key&&x(document.querySelector(".popup_opened"))}function C(e){e.classList.add("popup_opened"),window.addEventListener("keydown",E)}function x(e){e.classList.remove("popup_opened"),window.removeEventListener("keydown",E)}var A=function(e,t){e.disabled=t,e.textContent=t?"Сохранение...":"Сохранить"},w=document.querySelector(".popup_view-image"),U=w.querySelector(".popup__image"),B=w.querySelector(".popup__text"),T=document.querySelector("#places-template").content,P=document.querySelector(".places").querySelector(".places__items");function N(e){e.target.classList.toggle("places__btn-like_active")}function j(t,o,r,c,a,i){P.prepend(function(t,o,r,c,a,i){var l=T.querySelector(".places__item").cloneNode(!0);l.idCard=t,l.querySelector(".places__title").textContent=o,l.querySelector(".places__sum-like").textContent=c;var u=l.querySelector(".places__image");return u.src=r,u.alt=o,u.addEventListener("click",(function(e){B.textContent=o,U.src=r,U.alt=o,C(w)})),i&&l.querySelector(".places__btn-like").classList.add("places__btn-like_active"),l.querySelector(".places__btn-like").addEventListener("click",(function(e){e.target.classList.contains("places__btn-like_active")?function(e){return fetch("".concat(n.baseUrl,"/cards/likes/").concat(e),{method:"DELETE",headers:n.headers}).then(m)}(l.idCard).then((function(t){l.querySelector(".places__sum-like").textContent=t.likes.length,N(e)})).catch((function(e){return console.log(e)})):function(e){return fetch("".concat(n.baseUrl,"/cards/likes/").concat(e),{method:"PUT",headers:n.headers}).then(m)}(l.idCard).then((function(t){l.querySelector(".places__sum-like").textContent=t.likes.length,N(e)})).catch((function(e){return console.log(e)}))})),e!==a&&l.querySelector(".places__btn-remove").classList.add("places__btn-remove_inactive"),l.querySelector(".places__btn-remove").addEventListener("click",(function(e){(function(e){return fetch("".concat(n.baseUrl,"/cards/").concat(e),{method:"DELETE",headers:n.headers}).then(m)})(l.idCard).then((function(){return function(e){e.target.parentElement.remove()}(e)})).catch((function(e){return console.log(e)}))})),l}(t,o,r,c,a,i))}fetch("".concat(n.baseUrl,"/users/me"),{headers:n.headers}).then(m).then((function(t){e=t._id,_.value=t.avatar,h.src=t.avatar,S.textContent=t.name,b.textContent=t.about,a.value=t.name,i.value=t.about})).catch((function(e){return console.log(e)})),fetch("".concat(n.baseUrl,"/cards"),{headers:n.headers}).then(m).then((function(t){t.forEach((function(t){console.log("Author: ".concat(t.owner.name),t.likes);var n=Boolean(t.likes.find((function(t){return t._id===e})));j(t._id,t.name,t.link,t.likes.length,t.owner._id,n)}))})).catch((function(e){return console.log(e)})),console.log(e),q.addEventListener("click",(function(){C(r)})),g.addEventListener("click",(function(){C(l)})),y.addEventListener("click",(function(){C(p)})),o.forEach((function(e){e.addEventListener("mousedown",(function(t){t.target.classList.contains("popup_opened")&&x(e),t.target.classList.contains("popup__btn-close")&&x(e)}))})),c.addEventListener("submit",(function(e){var t,o;A(e.submitter,!0),(t=a.value,o=i.value,fetch("".concat(n.baseUrl,"/users/me"),{method:"PATCH",headers:n.headers,body:JSON.stringify({name:t,about:o})}).then(m)).then((function(){S.textContent=a.value,b.textContent=i.value})).catch((function(e){console.log(e),x(r)})).finally((function(){A(e.submitter,!1),x(r)}))})),u.addEventListener("submit",(function(e){var o,r;A(e.submitter,!0),(o=s.value,r=d.value,fetch("".concat(n.baseUrl,"/cards"),{method:"POST",headers:n.headers,body:JSON.stringify({name:o,link:r})}).then(m)).then((function(n){j(n._id,n.name,n.link,n.likes.length,n.owner._id,!1),s.value="",d.value="";var o=e.target.querySelector(t.submitButtonSelector);o.classList.add(t.inactiveButtonClass),o.setAttribute("disabled",!0)})).catch((function(e){console.log(e),x(l)})).finally((function(){A(e.submitter,!1),x(l)}))})),f.addEventListener("submit",(function(e){var t;A(e.submitter,!0),(t=_.value,fetch("".concat(n.baseUrl,"/users/me/avatar "),{method:"PATCH",headers:n.headers,body:JSON.stringify({avatar:t})}).then(m)).then((function(e){h.src=e.avatar})).catch((function(e){console.log(e),x(p)})).finally((function(){A(e.submitter,!1),x(p)}))})),function(e){Array.from(document.querySelectorAll(e.formSelector)).forEach((function(t){t.addEventListener("submit",(function(e){e.preventDefault()})),Array.from(t.querySelectorAll(e.formFieldsetSelector)).forEach((function(t){!function(e,t){var n=Array.from(e.querySelectorAll(t.inputSelector)),o=e.querySelector(t.submitButtonSelector);k(n,o,t),n.forEach((function(r){r.addEventListener("input",(function(){!function(e,t,n){t.validity.valid?function(e,t,n){var o=e.querySelector(".".concat(t.id,"-error"));t.classList.remove(n.inputErrorInvalid),o.classList.remove(n.errorClass),o.textContent=""}(e,t,n):function(e,t,n,o){var r=e.querySelector(".".concat(t.id,"-error"));t.classList.add(o.inputErrorInvalid),r.textContent=n,r.classList.add(o.errorClass)}(e,t,t.validationMessage,n)}(e,r,t),k(n,o,t)}))}))}(t,e)}))}))}(t)})();