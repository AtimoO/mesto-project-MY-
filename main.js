(()=>{"use strict";var e,t={formSelector:".popup__form",formFieldsetSelector:".popup__form-set",inputSelector:".popup__input",inputErrorInvalid:"popup__input_invalid",submitButtonSelector:".popup__form-submit",inactiveButtonClass:"popup__form-submit_inactive",errorClass:"popup__input-error_active"},n={baseUrl:"https://mesto.nomoreparties.co/v1/plus-cohort-5",headers:{authorization:"20520870-6cab-4f4f-bbfa-ddd25c12eab2","Content-Type":"application/json"}},r=document.querySelectorAll(".popup"),o=document.querySelector(".popup_edit"),c=o.querySelector(".popup__form"),a=c.querySelector("#name"),i=c.querySelector("#job"),l=document.querySelector(".popup_add"),u=l.querySelector(".popup__form"),s=u.querySelector("#name-card"),d=u.querySelector("#link"),p=document.querySelector(".popup_update-avatar"),f=p.querySelector(".popup__form"),m=f.querySelector("#linkNewPhoto"),v=function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))},_=document.querySelector(".profile"),y=_.querySelector(".profile__image"),h=_.querySelector(".profile__image-overlay"),b=_.querySelector(".profile__title"),S=_.querySelector(".profile__subtitle"),q=_.querySelector(".profile__edit"),g=_.querySelector(".profile__add"),E=function(e,t,n){L(e)?(t.classList.add(n.inactiveButtonClass),t.setAttribute("disabled",!0)):(t.classList.remove(n.inactiveButtonClass),t.removeAttribute("disabled"))},L=function(e){return e.some((function(e){return!e.validity.valid}))};function C(e){"Escape"===e.key&&A(document.querySelector(".popup_opened"))}function k(e){e.classList.add("popup_opened"),window.addEventListener("keydown",C)}function A(e){e.classList.remove("popup_opened"),window.removeEventListener("keydown",C)}var x=function(e,t){e.disabled=t,e.textContent=t?"Сохранение...":"Сохранить"},w=document.querySelector(".popup_view-image"),U=w.querySelector(".popup__image"),T=w.querySelector(".popup__text"),j=document.querySelector("#places-template").content,B=document.querySelector(".places").querySelector(".places__items");function P(e){e.target.classList.toggle("places__btn-like_active")}function I(t,r,o,c,a,i){B.prepend(function(t,r,o,c,a,i){var l=j.querySelector(".places__item").cloneNode(!0);l.idCard=t,l.querySelector(".places__title").textContent=r;var u=l.querySelector(".places__sum-like");u.textContent=c;var s=l.querySelector(".places__image");return s.src=o,s.alt=r,s.addEventListener("click",(function(e){T.textContent=r,U.src=o,U.alt=r,k(w)})),i&&l.querySelector(".places__btn-like").classList.add("places__btn-like_active"),l.querySelector(".places__btn-like").addEventListener("click",(function(e){e.target.classList.contains("places__btn-like_active")?function(e){return fetch("".concat(n.baseUrl,"/cards/likes/").concat(e),{method:"DELETE",headers:n.headers}).then(v)}(l.idCard).then((function(t){u.textContent=t.likes.length,P(e)})).catch((function(e){return console.log(e)})):function(e){return fetch("".concat(n.baseUrl,"/cards/likes/").concat(e),{method:"PUT",headers:n.headers}).then(v)}(l.idCard).then((function(t){u.textContent=t.likes.length,P(e)})).catch((function(e){return console.log(e)}))})),e!==a&&l.querySelector(".places__btn-remove").classList.add("places__btn-remove_inactive"),l.querySelector(".places__btn-remove").addEventListener("click",(function(e){(function(e){return fetch("".concat(n.baseUrl,"/cards/").concat(e),{method:"DELETE",headers:n.headers}).then(v)})(l.idCard).then((function(){return function(e){e.target.parentElement.remove()}(e)})).catch((function(e){return console.log(e)}))})),l}(t,r,o,c,a,i))}function O(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}Promise.all([fetch("".concat(n.baseUrl,"/users/me"),{headers:n.headers}).then(v),fetch("".concat(n.baseUrl,"/cards"),{headers:n.headers}).then(v)]).then((function(t){var n,r,o,c=(o=2,function(e){if(Array.isArray(e))return e}(r=t)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,c=[],a=!0,i=!1;try{for(n=n.call(e);!(a=(r=n.next()).done)&&(c.push(r.value),!t||c.length!==t);a=!0);}catch(e){i=!0,o=e}finally{try{a||null==n.return||n.return()}finally{if(i)throw o}}return c}}(r,o)||function(e,t){if(e){if("string"==typeof e)return O(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?O(e,t):void 0}}(r,o)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),l=c[0],u=c[1];e=(n=l)._id,m.value=n.avatar,y.src=n.avatar,b.textContent=n.name,S.textContent=n.about,a.value=n.name,i.value=n.about,u.forEach((function(t){var n=Boolean(t.likes.find((function(t){return t._id===e})));I(t._id,t.name,t.link,t.likes.length,t.owner._id,n)}))})).catch((function(e){return console.log(e)})),q.addEventListener("click",(function(){k(o)})),g.addEventListener("click",(function(){k(l)})),h.addEventListener("click",(function(){k(p)})),r.forEach((function(e){e.addEventListener("mousedown",(function(t){t.target.classList.contains("popup_opened")&&A(e),t.target.classList.contains("popup__btn-close")&&A(e)}))})),c.addEventListener("submit",(function(e){var t,r;x(e.submitter,!0),(t=a.value,r=i.value,fetch("".concat(n.baseUrl,"/users/me"),{method:"PATCH",headers:n.headers,body:JSON.stringify({name:t,about:r})}).then(v)).then((function(){b.textContent=a.value,S.textContent=i.value,A(o)})).catch((function(e){console.log(e)})).finally((function(){x(e.submitter,!1)}))})),u.addEventListener("submit",(function(e){var r,o;e.submitter.textContent="Создание...",(r=s.value,o=d.value,fetch("".concat(n.baseUrl,"/cards"),{method:"POST",headers:n.headers,body:JSON.stringify({name:r,link:o})}).then(v)).then((function(n){I(n._id,n.name,n.link,n.likes.length,n.owner._id,!1),s.value="",d.value="",e.submitter.classList.add(t.inactiveButtonClass),e.submitter.setAttribute("disabled",!0),A(l)})).catch((function(e){console.log(e)})).finally((function(){e.submitter.textContent="Создать"}))})),f.addEventListener("submit",(function(e){var t;x(e.submitter,!0),(t=m.value,fetch("".concat(n.baseUrl,"/users/me/avatar "),{method:"PATCH",headers:n.headers,body:JSON.stringify({avatar:t})}).then(v)).then((function(e){y.src=e.avatar,A(p)})).catch((function(e){console.log(e)})).finally((function(){x(e.submitter,!1)}))})),function(e){Array.from(document.querySelectorAll(e.formSelector)).forEach((function(t){t.addEventListener("submit",(function(e){e.preventDefault()})),Array.from(t.querySelectorAll(e.formFieldsetSelector)).forEach((function(t){!function(e,t){var n=Array.from(e.querySelectorAll(t.inputSelector)),r=e.querySelector(t.submitButtonSelector);E(n,r,t),n.forEach((function(o){o.addEventListener("input",(function(){!function(e,t,n){t.validity.valid?function(e,t,n){var r=e.querySelector(".".concat(t.id,"-error"));t.classList.remove(n.inputErrorInvalid),r.classList.remove(n.errorClass),r.textContent=""}(e,t,n):function(e,t,n,r){var o=e.querySelector(".".concat(t.id,"-error"));t.classList.add(r.inputErrorInvalid),o.textContent=n,o.classList.add(r.errorClass)}(e,t,t.validationMessage,n)}(e,o,t),E(n,r,t)}))}))}(t,e)}))}))}(t)})();